<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>File System </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="File System ">
    <meta name="generator" content="docfx 2.45.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../index.html" title="Home">Home</a>
                      </li>
                      <li>
                          <a href="https://gocosmos.org" title="Cosmos Website">Cosmos Website</a>
                      </li>
                      <li>
                          <a href="../../articles/GettingStarted.html" title="Articles">Articles</a>
                      </li>
                      <li>
                          <a href="../../api/Cosmos.Build.Tasks.html" title="API Documentation">API Documentation</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../GettingStarted.html" title="Getting Started" class="">Getting Started</a>
                    </li>
                    <li class="">
                      <a href="../Compiler/il2cpu.html" title="Compiler" class="">Compiler</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Debugger</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Debugger/DebugCommands.html" title="Debug Commands" class="">Debug Commands</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <a href="../Express/Compile.html" title="Express" class="">Express</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Installation</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Installation/DevKit.html" title="Dev Kit" class="">Dev Kit</a>
                          </li>
                          <li class="">
                            <a href="../Installation/Running.html" title="Running" class="">Running</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Kernel</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Kernel/Heap.html" title="Heap" class="">Heap</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Levels.html" title="Levels" class="">Levels</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Memory.html" title="Memory" class="">Memory</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Plugs.html" title="Plugs" class="">Plugs</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Startup.html" title="Startup" class="">Startup</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/CGS.html" title="Graphics" class="">Graphics</a>
                          </li>
                          <li class="active">
                            <a href="../Kernel/VFS.html" title="Virtual File System" class="active">Virtual File System</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Reference</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Reference/x86.html" title="x86" class="">x86</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Tests</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Tests/TestRunner.html" title="Test Runner" class="">Test Runner</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="file-system">File System</h1>

<p>In this article we will discuss about using Cosmos VFS (virtual file system).
Cosmos VFS and the VFS manager classes, let you manage your file system.</p>
<p>First, we should create and initialize an instance of the VFS, this will initialize the partition and files-system lists, as well as register the new VFS.
This is essential for using the VFS.</p>
<p>We start with creating global CosmosVFS, this line should appear outside of any function, and before the BeforeRun() function.</p>
<pre><code class="lang-C#">CosmosVFS fs = new Sys.FileSystem.CosmosVFS();
</code></pre>
<p>Next, we register our VFS at the VFS manager, this will initiate the VFS and make it usable, add this to your kernel's BeforeRun():</p>
<pre><code class="lang-C#">Sys.FileSystem.VFS.VFSManager.RegisterVFS(fs);
</code></pre>
<p>After the initialization process is done, a message like this would apper on your screen:
<img src="https://raw.githubusercontent.com/CosmosOS/Cosmos/master/Docs/articles/Kernel/images/File%20System%20Initialize.PNG" alt="Initialize"></p>
<p>This message is printed by the register method and it provides info about the file system.</p>
<p>After our VFS has been initialized, we can use more interesting functions, lets go over some of them:</p>
<h2 id="get-available-free-space">Get available free space</h2>
<p>We use this function to get the size of the available free space in our file system, in bytes.</p>
<pre><code class="lang-C#">long available_space = fs.GetAvailableFreeSpace(&quot;0:/&quot;);
Console.WriteLine(&quot;Available Free Space: &quot; + available_space);
</code></pre>
<p><img src="https://raw.githubusercontent.com/CosmosOS/Cosmos/master/Docs/articles/Kernel/images/File%20System%20Free%20Space.PNG" alt="Free Space"></p>
<p>You have probably noticed the &quot;0:/&quot; argument passed to this function, this is the id of the drive that we want to get available free space of.
Cosmos using DOS drive naming system and this is why we use &quot;0&quot;.</p>
<h2 id="get-file-system-type">Get file system type</h2>
<p>This will let us know what is the file system type that we are using.</p>
<p><img src="https://raw.githubusercontent.com/CosmosOS/Cosmos/master/Docs/articles/Kernel/images/File%20System%20Type.PNG" alt="System Type"></p>
<pre><code class="lang-C#">string fs_type = fs.GetFileSystemType(&quot;0:/&quot;);
Console.WriteLine(&quot;File System Type: &quot; + fs_type);
</code></pre>
<h2 id="get-files-list">Get files list</h2>
<p>We start by getting the directory entrys list, using:</p>
<pre><code class="lang-C#">var directory_list = fs.GetDirectoryListing(&quot;0:/&quot;);
</code></pre>
<p>Once we have it, we can get the names of our files:</p>
<pre><code class="lang-C#">foreach (var directoryEntry in directory_list)
{
    Console.WriteLine(directoryEntry.mName);
}
</code></pre>
<p><img src="https://raw.githubusercontent.com/CosmosOS/Cosmos/master/Docs/articles/Kernel/images/File%20System%20Files%20List.PNG" alt="Files List"></p>
<h2 id="read-all-the-files-in-a-directory">Read all the files in a directory</h2>
<p>This one is more tricky,
We need to get a directoryEntryList, find files in the list and print the content to the screen.</p>
<p>of course, we start with geting the directory listing;</p>
<pre><code class="lang-C#">var directory_list = fs.GetDirectoryListing(&quot;0:/&quot;);
</code></pre>
<p>Now we can go through our list, and and print the txt file content.</p>
<pre><code class="lang-C#">try
{
    foreach (var directoryEntry in directory_list)
    {
        var file_stream = directoryEntry.GetFileStream();
        var entry_type = directoryEntry.mEntryType;
        if(entry_type == Sys.FileSystem.Listing.DirectoryEntryTypeEnum.File)
        {
            byte[] content = new byte[file_stream.Length];
            file_stream.Read(content, 0, (int)file_stream.Length);
            Console.WriteLine(&quot;File name: &quot; + directoryEntry.mName);
            Console.WriteLine(&quot;File size: &quot; + directoryEntry.mSize);
            Console.WriteLine(&quot;Content: &quot;);
            foreach (char ch in content)
            {
                Console.Write(ch.ToString());
            }
            Console.WriteLine();
        }
    }
}
catch(Exception e)
{
    Console.WriteLine(e.ToString());
}
</code></pre>
<p><img src="https://raw.githubusercontent.com/CosmosOS/Cosmos/master/Docs/articles/Kernel/images/File%20System%20Read%20File.PNG" alt="Read File"></p>
<h2 id="read-specific-file">Read specific file</h2>
<p>Now we will read specific file from a path.<br>
As usual, we do it in a try catch block.</p>
<pre><code class="lang-C#">try
{
    var hello_file = fs.GetFile(@&quot;0:\hello_from_elia.txt&quot;);
    var hello_file_stream = hello_file.GetFileStream();

    if (hello_file_stream.CanRead)
    {
        byte[] text_to_read = new byte[hello_file_stream.Length];
        hello_file_stream.Read(text_to_read, 0, (int)hello_file_stream.Length);
        Console.WriteLine(Encoding.Default.GetString(text_to_read));
    }
}
catch (Exception e)
{
    Console.WriteLine(e.ToString());
}
</code></pre>
<p>We use the GetFile() method, which returns a file from a path.<br>
Next we open a stream to the file and check if we can read it.<br>
The last thing we do is reading from the stream, we use Read() method, which write the stream to a byte array.</p>
<p><img src="https://raw.githubusercontent.com/CosmosOS/Cosmos/master/Docs/articles/Kernel/images/File%20System%20Read%20Specified%20File.PNG" alt="Read Specific File"></p>
<p>Notice that there is no much difference between this and <a href="https://github.com/CosmosOS/Cosmos/wiki/FAT-FileSystem#read-all-the-files-in-a-directory">read all the files in a directory</a>.<br>
Actually the difference is by using GetFile() instead of GetDirectoryListing(), as the first returns single DirectoryEntry, and the second returns DirectoryEntryList.</p>
<h2 id="write-to-a-file">Write to a file</h2>
<p>Now we will write to an existing file.<br>
Writing to a file is almost the same as reading from a file.<br>
Always remember, we should use try catch block.</p>
<pre><code class="lang-C#">try
{
    var hello_file = fs.GetFile(@&quot;0:\hello_from_elia.txt&quot;);
    var hello_file_stream = hello_file.GetFileStream();

    if (hello_file_stream.CanWrite)
    {
        byte[] text_to_write = Encoding.ASCII.GetBytes(&quot;Learning how to use VFS!&quot;);
        hello_file_stream.Write(text_to_write, 0, text_to_write.Length);
    }
}
catch (Exception e)
{
    Console.WriteLine(e.ToString());
}
</code></pre>
<p>Again we use the GetFile() method, which returns a file from a path.<br>
Next we open a stream to the file and check if we can write to it.<br>
The last thing we do is writing to the stream, we use Write() method, which write a byte array to the stream.</p>
<h2 id="create-new-file">Create new file</h2>
<p>Reading and writing is working on existing files, but it's much more useful to write to our own files.
let's jump right into it:</p>
<pre><code class="lang-C#">try
{
    fs.CreateFile(@&quot;0:\hello_from_elia.txt&quot;);
}
catch (Exception e)
{
    Console.WriteLine(e.ToString());
}
</code></pre>
<p>This would create new, empty file (its size is 0 bytes), we can write to it by using <a href="https://github.com/CosmosOS/Cosmos/wiki/FAT-FileSystem/_edit#write-to-a-file">this method</a>.<br>
Now we can <a href="https://github.com/CosmosOS/Cosmos/wiki/FAT-FileSystem#get-files-list">check our files list</a> and see our new file in it:</p>
<p><img src="https://raw.githubusercontent.com/CosmosOS/Cosmos/master/Docs/articles/Kernel/images/File%20System%20Create%20File.PNG" alt="Create File"></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/CosmosOS/Cosmos/blob/d5210e45e5e82a2b9cb8152c86280ab2cbb851ad/Docs/articles/Kernel/VFS.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
