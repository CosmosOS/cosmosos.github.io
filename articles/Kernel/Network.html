<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Network </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Network ">
    <meta name="generator" content="docfx 2.56.7.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../index.html" title="Home">Home</a>
                      </li>
                      <li>
                          <a href="../../install.html" title="Install">Install</a>
                      </li>
                      <li>
                          <a href="https://gocosmos.org" title="Cosmos Website">Cosmos Website</a>
                      </li>
                      <li>
                          <a href="../../articles/GettingStarted.html" title="Articles">Articles</a>
                      </li>
                      <li>
                          <a href="../../api/Cosmos.Build.Tasks.html" title="API Documentation">API Documentation</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../GettingStarted.html" title="Getting Started" class="">Getting Started</a>
                    </li>
                    <li class="">
                      <a href="../Compiler/il2cpu.html" title="Compiler" class="">Compiler</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Debugger</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Debugger/DebugCommands.html" title="Debug Commands" class="">Debug Commands</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <a href="../Express/Compile.html" title="Express" class="">Express</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Installation</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Installation/DevKit.html" title="Dev Kit" class="">Dev Kit</a>
                          </li>
                          <li class="">
                            <a href="../Installation/Running.html" title="Running" class="">Running</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Kernel</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Kernel/Heap.html" title="Heap" class="">Heap</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Levels.html" title="Levels" class="">Levels</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Memory.html" title="Memory" class="">Memory</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Plugs.html" title="Plugs" class="">Plugs</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Startup.html" title="Startup" class="">Startup</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/CGS.html" title="Graphics" class="">Graphics</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/VFS.html" title="Virtual File System" class="">Virtual File System</a>
                          </li>
                          <li class="active">
                            <a href="../Kernel/Network.html" title="Network" class="active">Network</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Reference</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Reference/x86.html" title="x86" class="">x86</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Tests</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Tests/TestRunner.html" title="Test Runner" class="">Test Runner</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="network">Network</h1>

<p>In this article we will discuss about Networking on Cosmos, how to use the Network Stack, send and receive packets. For now, available protocols are <strong>ARP</strong>, <strong>IPv4</strong>, <strong>TCP</strong>, <strong>UDP</strong>, <strong>ICMP</strong>, <strong>DHCP</strong> and <strong>DNS</strong>. Note that Cosmos devkit must be installed for this article.</p>
<p>All protocols here don't necessary support every feature described by their RFC and may have some bugs or architecture issues, if you find bugs or something abnormal please <a href="https://github.com/CosmosOS/Cosmos/issues/new/choose">submit an issue</a> on our repository.</p>
<p>Each protocol has a Client class which can be used to receive and send data. If a Receive() method is blocking, the method will timeout after 5 seconds or use the value optionally set by parameter. Please note that all finished connections should be closed using Close().</p>
<p>Cosmos Network Stack won't use Classes and Functions that are under .NET Core. Everything described here will be under:</p>
<pre><code class="lang-csharp">using Cosmos.System.Network;
</code></pre>
<p>Before anything, a Network Configuration must be set (local machine IPv4 address, subnet mask and gateway). It can be manually set with IPConfig.Enable or dynamically set through a DHCP server. For DHCP, Cosmos will ask to the DHCP server (usually default gateway) for an address in your local network.</p>
<h3 id="manually-set-ipv4-config">Manually set IPv4 Config</h3>
<pre><code class="lang-csharp">NetworkDevice nic = NetworkDevice.GetDeviceByName(&quot;eth0&quot;); //get network device by name
IPConfig.Enable(nic, new Address(192, 168, 1, 69), new Address(255, 255, 255, 0), new Address(192, 168, 1, 254)); //enable IPv4 configuration
</code></pre>
<h3 id="dynamically-set-ipv4-config-through-dhcp">Dynamically set IPv4 Config through DHCP</h3>
<pre><code class="lang-csharp">using(var xClient = new DHCPClient())
{
    /** Send a DHCP Discover packet **/
    //This will automatically set the IP config after DHCP response
    xClient.SendDiscoverPacket();
}
</code></pre>
<h2 id="tcp">TCP</h2>
<p>Like UDP, TCP has to create a client and call Connect() to specify the remote machine address before sending or receiving data.</p>
<p>Server :</p>
<pre><code class="lang-csharp">using(var xServer = new TcpListener(4242))
{
    /** Start server **/
    xServer.Start();
    
    /** Accept incoming TCP connection **/
    var client = xServer.AcceptTcpClient(); //blocking
    
    /** Stop server **/
    xServer.Stop();

    /** Send data **/
    client.Send(Encoding.ASCII.GetBytes(message));
}
</code></pre>
<p>Client :</p>
<pre><code class="lang-csharp">using(var xClient = new TcpClient(4242))
{
    xClient.Connect(new Address(192, 168, 1, 70), 4242);

    /** Send data **/
    xClient.Send(Encoding.ASCII.GetBytes(message));

    /** Receive data **/
    var endpoint = new EndPoint(Address.Zero, 0);
    var data = xClient.Receive(ref endpoint);  //set endpoint to remote machine IP:port
    var data2 = xClient.NonBlockingReceive(ref endpoint); //retrieve receive buffer without waiting
}
</code></pre>
<h2 id="ftp">FTP</h2>
<p>Only server side is implemented in Cosmos. We recommand to use FileZilla as your FTP client.</p>
<p><strong>Your FTP client must enable active mode</strong>. Since in Active Mode the server has to open TCP connections, <strong>your computer firewall must be disabled</strong> to accept incoming connection. An FTP connection is made of two TCP sockets. One for control connection (as a textual protocol) and one for data transmission. Data transmission sockets can be opened by the client (if it is in Passive Mode) or by the server (if in Active Mode). The Passive Mode is not supported yet due to current Cosmos TCP and multithreading limitation.</p>
<p>FTP client configuration (plain FTP, Anonymous):</p>
<p><img src="https://user-images.githubusercontent.com/18724279/121685499-4c71f380-cac0-11eb-8d08-6db1c0096e68.png" alt="FTP client configuration"></p>
<p>Please note that for now only one FTP connection can be accepted, the server will shut down itself after the client disconnection.</p>
<pre><code class="lang-csharp">/** Initialize filesystem **/
var fs = new CosmosVFS();
VFSManager.RegisterVFS(fs);

using(var xServer = new FtpServer(fs, &quot;0:\\&quot;))
{
    /** Listen for new FTP client connections **/
    ftpSever.Listen();
}
</code></pre>
<h2 id="udp">UDP</h2>
<p>Before playing with packets, we have to create a client and call Connect() to specify the remote machine address. After that the client will be able to send or listen for data.</p>
<pre><code class="lang-csharp">using(var xClient = new UdpClient(4242))
{
    xClient.Connect(new Address(192, 168, 1, 70), 4242);

    /** Send data **/
    xClient.Send(Encoding.ASCII.GetBytes(message));

    /** Receive data **/
    var endpoint = new EndPoint(Address.Zero, 0);
    var data = xClient.Receive(ref endpoint);  //set endpoint to remote machine IP:port
    var data2 = xClient.NonBlockingReceive(ref endpoint); //retrieve receive buffer without waiting
}
</code></pre>
<h2 id="icmp">ICMP</h2>
<p>For ICMP, we will only be able to send an ICMP echo to a distant machine and wait for its response. If another machine sends us an ICMP echo, Cosmos will automatically handle the request and reply.</p>
<pre><code class="lang-csharp">using(var xClient = new ICMPClient())
{
    xClient.Connect(new Address(192, 168, 1, 254));

    /** Send ICMP Echo **/
    xClient.SendEcho();

    /** Receive ICMP Response **/
    int time = xClient.Receive(ref endpoint); //return elapsed time / timeout if no response
}

</code></pre>
<h2 id="dns">DNS</h2>
<p>DNS can be used to get an IP address from a Domain Name string. For now DNS can only ask for one domain name at the same time.</p>
<pre><code class="lang-csharp">using(var xClient = new DnsClient())
{
    xClient.Connect(new Address(192, 168, 1, 254)); //DNS Server address

    /** Send DNS ask for a single domain name **/
    xClient.SendAsk(&quot;github.com&quot;);

    /** Receive DNS Response **/
    Address destination = xClient.Receive(); //can set a timeout value
}

</code></pre>
<h2 id="get-local-ip-address">Get local IP address</h2>
<pre><code class="lang-csharp">Console.WriteLine(NetworkConfig.CurrentConfig.Value.IPAddress.ToString());
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/CosmosOS/Cosmos/blob/34b27b10d2e59e9527261e83b780773f02870319/Docs/articles/Kernel/Network.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
