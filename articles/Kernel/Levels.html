<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Goals </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Goals ">
    <meta name="generator" content="docfx 2.45.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../index.html" title="Home">Home</a>
                      </li>
                      <li>
                          <a href="https://gocosmos.org" title="Cosmos Website">Cosmos Website</a>
                      </li>
                      <li>
                          <a href="../../articles/GettingStarted.html" title="Articles">Articles</a>
                      </li>
                      <li>
                          <a href="../../api/Cosmos.Build.Tasks.html" title="API Documentation">API Documentation</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../GettingStarted.html" title="Getting Started" class="">Getting Started</a>
                    </li>
                    <li class="">
                      <a href="../Compiler/il2cpu.html" title="Compiler" class="">Compiler</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Debugger</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Debugger/DebugCommands.html" title="Debug Commands" class="">Debug Commands</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <a href="../Express/Compile.html" title="Express" class="">Express</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Installation</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Installation/DevKit.html" title="Dev Kit" class="">Dev Kit</a>
                          </li>
                          <li class="">
                            <a href="../Installation/Running.html" title="Running" class="">Running</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Kernel</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Kernel/Heap.html" title="Heap" class="">Heap</a>
                          </li>
                          <li class="active">
                            <a href="../Kernel/Levels.html" title="Levels" class="active">Levels</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Memory.html" title="Memory" class="">Memory</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Plugs.html" title="Plugs" class="">Plugs</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/Startup.html" title="Startup" class="">Startup</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/CGS.html" title="Graphics" class="">Graphics</a>
                          </li>
                          <li class="">
                            <a href="../Kernel/VFS.html" title="Virtual File System" class="">Virtual File System</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Reference</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Reference/x86.html" title="x86" class="">x86</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Tests</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Tests/TestRunner.html" title="Test Runner" class="">Test Runner</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<p>The security model of Cosmos will evolve and mature as
Cosmos does, however the base model is presented here.</p>
<h3 id="goals">Goals</h3>
<p>Most operating systems today use hardware to enforce security between the
kernel, user code, etc. This creates a lot of overhead at runtime and
decreases performance. Intel CPUs have built this into the hardware, but adds
a fair bit of circuitry and complexity. Despite being in hardware, it still
incurs a measureable performance penalty. Since Cosmos can control execution
and rebuild its compiler and recompile all code at any time, Cosmos can be
much more flexible and most restrictions can be enforced at compile or
installation time rather than the need to perform such CPU checks in live CPU
code. This creates huge performance gains but also allows a lot more
flexibility.</p>
<h3 id="future">Future</h3>
<p>Currently only basic checking is implemented into the compiler. This means that some restrictions are implemented whilst some must be checked manually.</p>
<p>Currently only this is implemented:</p>
<ul>
<li>Restriction of references list to higher levels only. ie HAL can reference Core
but not vice versa. Also via attribute. That is an assembly level attribute to mark which level an assembly is.</li>
</ul>
<p>In the future both of these will also be implemented:</p>
<ol>
<li>Restriction of core level exclusive abilities at the assembly level by attribute.</li>
<li>Restrict access to BCL and other assemblies. ie Core should never need XML
or other higher level services. Make a defined list of what is allowed and verify against it.</li>
</ol>
<p>For now we must be vigilant to watch these restrictions manually.</p>
<h3 id="using-rings">Using rings</h3>
<p>It is not possible to run Hardware code in the kernel because it is in ring USER. This means that you cant access the display code in your kernel. To get around this one must create some code in ring 2 (SYSTEM) which allows you to interface between the two. To do this follow this guide:</p>
<h3 id="guide">Guide:</h3>
<p>To do this right click on your solution on the right hand side and click Add-&gt;New Project. Then add a new COSMOS C# OS, call it Hardware. Now you need to both delete the NEW Cosmos boot project (called HardwareBoot) and the Kernel.cs file found within the main Hardware project.</p>
<p>The next job is to allow this project to talk to the screen. To do this right click on the references section of the Hardware project-&gt;add references. Now search for cosmos and add all the references (by selecting them with shift-click then pressing ENTER)</p>
<p>Now go into the AssemblyInfo.cs of the Hardware project file and add the lines bellow:</p>
<p>using Cosmos.Common;
[assembly: Ring(Ring.System)]
Well done, you now have a project running in Ring 2.</p>
<h3 id="levels">Levels</h3>
<p>Many operating systems refer to their security &quot;areas&quot; as rings. ie Kernel
ring, etc. Rings are harder to draw in text and make diagramming a bit harder,
so for now we will refer to our &quot;areas&quot; as levels.</p>
<p>Cosmos is split into the following levels:</p>
<ul>
<li>0 Core</li>
<li>1 Hardware</li>
<li>2 System</li>
<li>3 User</li>
</ul>
<p>Each level can only communicate with adjacent levels. That is User can only
talk to System, but not Core.</p>
<p>To make an assembly part of a specific level, you'll have to mark it with the
attribute below to specify on what ring this code is (add the attribute in
AssemblyInfo.cs).</p>
<p><code>[assembly: Ring(Ring.User)]</code></p>
<p>The following are valid enums for the attribute.</p>
<pre><code>public enum Ring
{
    Core = 0,
    HAL = 1,
    System = 2,
    User = 3,

}
</code></pre>
<h3 id="0-core">0 Core</h3>
<p>Summary: &quot;Anything goes&quot;
Implements: IO and memory classes
Specificity: CPU
Assemblies: Cosmos Only</p>
<p>Core exists to provide access to hardware. C# code should mostly
exist in level 1 instead, with level 0 being intended for code that can exist
only in core such as assembly code.</p>
<p>Core has special permissions which essentially allow it do anything.
Core code is to be very limited with most kernel code existing in the System
level. Core code is to be kept to a minimum. Code not requiring special
permissions should be moved or split into the system level.</p>
<p>Things that can exist only in Core - no other levels.</p>
<ol>
<li>Assembly plugs</li>
<li>Unsafe code (pointers)</li>
</ol>
<p>Core via unsafe code and assembly plugs is used to expose classes to system allowing
system to interact with hardware.</p>
<p>Core can contain only assemblies of Cosmos itself. No drivers or non Cosmos code is allowed in Core.</p>
<p>Things that Core implements and exposes to HAL:</p>
<ol>
<li>IO Ports (x86 and some others). Exposes safe interface and implemented using assembly plugs.</li>
<li>Memory Access. Exposes safe interfaces which keep all pointer access in Core. HAL and lower use
objects which expose byte arrays and other methods to allow HAL to communicate with memory without
using pointers itself.</li>
<li>IRQs and other CPU specific functions.</li>
<li>Threading</li>
<li>Memory Management.</li>
<li>PCI</li>
</ol>
<p>Core also manages consumers of its services to avoid conflicts and security to prevent a specific driver from accessing &quot;everything&quot;.</p>
<p>Notes:
<a href="https://github.com/joeduffy/slice.net">https://github.com/joeduffy/slice.net</a></p>
<h3 id="1-hal-hardware-abstraction-layer">1 HAL (Hardware Abstraction Layer)</h3>
<p>Summary: Hardware control
Specificity: Hardware (ie Keyboard, USB, Video), but not CPU
Assemblies: Cosmos, Drivers</p>
<p>HAL uses Core to access hardware and implements the logic details in HAL. Core implements only raw
classes for accessing hardware, but knows nothing about most of the hardware itself. ie, HAL would implement the
logic for talking to the keyboard using the hardwarwe access classes in Core. Core simply facilitates the
communication for HAL to the hardware.</p>
<p>Examples:</p>
<ol>
<li>Raw graphics access (Send this command to graphics card, etc)</li>
<li>Raw disk access</li>
<li>USB</li>
</ol>
<h3 id="2-system">2 System</h3>
<p>Summary: Main part of OS
Specificity: None (not tied to any hardware or CPU)
Assemblies: Cosmos, Drivers</p>
<p>System level contains all such code that is not wrapping hardware directly but
instead adding higher level functionality. ie file systems, etc. The
distinction between level 1 and 2 is a manual one and no technical
restrictions currently exist aside from the restriction of higher level
reference only.</p>
<p>System should not contain system applications, but instead system
functionality. System applications belong in User.</p>
<p>Examples:</p>
<ol>
<li>File systems</li>
<li>BCL plugs</li>
<li>Network stacks</li>
<li>Graphics with higher level API consumable by user apps. (Things that cannot be accomplished by hardware. Loading images from files, drawing things not supported by a graphics card command)</li>
</ol>
<h3 id="3-user-level">3 User Level</h3>
<p>Summary: User applications
Specificity: None
Assemblies: Any</p>
<p>No Cosmos.3.User project exists because level 3 is user code. ie applications.
When a user creates a new application (or currently monolithic project) the
code is level 3.</p>
<p>Examples:</p>
<ol>
<li>User applications</li>
<li>System applications</li>
</ol>
<p>We considered adding a special &quot;playground&quot; ring, which is able to do more.
This would aid in adding new code in playground which is targetted at System
level. However, this adds a possibility you functionally don't really need:
You only need to add 1 or maybe 2 extra projects, but this give you the
physical separation from the start, preventing you to make circular
references.</p>
<h1 id="examples">Examples</h1>
<h2 id="disk">Disk</h2>
<p>0 IO/Memory access (Cosmos)
1 IDE / SATA
2 Block Device, Filesystem
3 Application</p>
<h2 id="graphics">Graphics</h2>
<p>0 IO/Memory access (Cosmos)
1 DirectX / VESA / Graphics Memory
2 WinForms, WPF, Other UI, Canvas, JPG/PNG/GIF
3 Application</p>
<h2 id="network">Network</h2>
<p>0 IO/Memory access (Cosmos)
1 Ethernet
2 TCP/IP
3 Application</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/CosmosOS/Cosmos/blob/e53eea929e3615f35b7c7e3dbec39ae1b0929d96/Docs/articles/Kernel/Levels.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
